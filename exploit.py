import subprocess
import re

def main():
    # Prompt user for input
    user_input = input("Enter a domain or pattern to search for: ")

    # Construct the curl command with the user input
    curl_command = [
        "curl", "-G", "https://web.archive.org/cdx/search/cdx",
        "--data-urlencode", f"url=*.{user_input}/*",
        "--data-urlencode", "collapse=urlkey",
        "--data-urlencode", "output=text",
        "--data-urlencode", "fl=original"
    ]

    # Output file
    output_file = "out.txt"

    # Run the curl command and write output to file
    with open(output_file, "w") as file:
        subprocess.run(curl_command, stdout=file)

    print(f"Results saved to {output_file}")

    # Read the file and filter its contents
    with open(output_file, "r") as file:
        lines = file.readlines()

    # Define the regex for filtering
    pattern = re.compile(r'\.xls|\.xml|\.xlsx|\.json|\.pdf|\.sql|\.doc|\.docx|\.pptx|\.txt|\.zip|\.tar|\.gz|\.tgz|\.bak|\.7z|\.rar|\.log|\.cache|\.secret|\.db|\.backup|\.yml|\.gz|\.config|\.csv|\.yaml|\.md|\.md5|\.exe|\.dll|\.bin|\.ini|\.bat|\.sh|\.tar|\.deb|\.rpm|\.iso|\.img|\.apk|\.msi|\.dmg|\.tmp|\.crt|\.pem|\.key|\.pub|\.asc')

    # Filter the lines that match the pattern
    filtered_lines = [line.strip() for line in lines if pattern.search(line)]

    # Save filtered results to a file
    filtered_file = "filtered.txt"
    with open(filtered_file, "w") as file:
        file.write("\n".join(filtered_lines))

    print(f"Filtered results saved to {filtered_file}")

if __name__ == "__main__":
    main()
